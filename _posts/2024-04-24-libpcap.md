---
title: "[Android] libpcap with ndk-build "
excerpt: ""

categories:
  - Security
tags:
  - [Security, Android]

permalink: /Security/libpcap-build/

toc: true
toc_sticky: true

date: 2024-04-25
last_modified_at: 2024-04-25
---

# â˜ğŸ» libpcap ë¹Œë“œ

cppë¡œ í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ë•Œ pcap libraryë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.<br>
ì´ë²ˆ postì—ì„œëŠ” Android ëŒ€ìƒ pcap ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•˜ëŠ” ë°©ë²•ê¹Œì§€ ë‹¤ë¤„ë³´ë„ë¡ í•˜ê² ë‹¤.<br>
íŠ¹íˆ libpcapì„ shared_libraryë¡œ ë¹Œë“œí•˜ëŠ” ê³¼ì •ì— ëŒ€í•œ ì„¤ëª…ì€ ë”°ë¡œ ì°¾ì•„ë´ë„ ì—†ê¸°ë•Œë¬¸ì— ë”°ë¡œ ë‚¨ê²¨ë³´ë ¤ê³  í•œë‹¤.<br>

# â˜ğŸ» how to ?
libpcapì„ ë¹Œë“œí•˜ê¸° ìœ„í•´ì„œ cmake, configure ìŠ¤í¬ë¦½íŠ¸, ë“±ë“± ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆì§€ë§Œ, <br>
ì €ë²ˆ Postì— ì´ì–´ì„œ ndk-buildë¥¼ ì´ìš©í•œ ë¹Œë“œë¥¼ ì§„í–‰í•´ë³´ê³ ì í•œë‹¤.<br>

ë¹Œë“œ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.<br>

1) libpcap ì†ŒìŠ¤ ë°›ê¸°<br>
2) Android.mk, Application.mk ì‘ì„±<br>
3) ndk-build ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰<br>

## libpcap ì†ŒìŠ¤ ë°›ê¸°
```
git clone https://android.googlesource.com/platform/external/libpcap
```

[ë§í¬](https://android.googlesource.com/platform/external/libpcap)

## Android.mk, Application.mk ì‘ì„±
Android.mk, Application.mkë¥¼ ì‘ì„±í•˜ê¸° ì „ì— ë¨¼ì € ndk-buildë¥¼ ì´ìš©í•´ë´ì•¼ê² ë‹¤ëŠ” ìƒê°ì„ í•˜ê²Œ ëœ ê³„ê¸°ë¥¼ ì„¤ëª…í•´ë³´ê³ ì í•œë‹¤.<br>
libpcapì„ ë¹Œë“œí•˜ê¸° ìœ„í•´ cmake, configure ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•´ë´¤ë‹¤.<br>
ê°ê°ì´ ì¥ë‹¨ì ì´ ìˆì—ˆë‹¤.<br>

cmakeì˜ ê²½ìš°ì—ëŠ” ì‰½ê³  í¸í•˜ì§€ë§Œ ë‚´ê°€ ì˜ ëª°ëê³ ,<br>
configureì˜ ê²½ìš°ì—ëŠ” ë§¤ë²ˆ ì•„í‚¤í…ì²˜ë¥¼ ì„ íƒí•´ì¤˜ì•¼ í•˜ëŠ”ë° ê·¸ ê³¼ì •ì´ ë„ˆë¬´ ë²ˆê±°ë¡­ë‹¤ê³  ëŠê»´ì¡Œë‹¤.<br>

íŠ¹íˆ ì•„í‚¤í…ì²˜ë¥¼ ë‹¬ë¦¬í•˜ê²Œ ëœë‹¤ë©´ ë§¤ë²ˆ ë‹¬ë¦¬ ë¹Œë“œë¥¼ ì§„í–‰í•´ì•¼í•œë‹¤ëŠ” ì ì—ì„œ, <br>
í•œë²ˆì— ì´ ì‘ì—…ì„ í•  ìˆ˜ëŠ” ì—†ì„ê¹Œ ? ì— ëŒ€í•œ ê³ ë¯¼ì„ í–ˆë‹¤.<br>

íŠ¹íˆ libpcap ì†ŒìŠ¤ì½”ë“œë¥¼ ì‚´í´ë³´ë‹¤ê°€ Android.bp íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œê²Œë˜ì–´ ì§„í–‰ì„ í•˜ê²Œ ë˜ì—ˆë‹¤.libpcapì„ ndk-buildë¥¼ ì´ìš©í•´ì„œ ë¹Œë“œí•˜ê¸° ë³´ë‹¤ëŠ” ìµœê·¼ì—ëŠ” configureë‚˜ cmakeë¥¼ ë§ì´ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— êµ³ì´ ndk-buildë¥¼ ì´ìš©í•  í•„ìš”ëŠ” ì—†ì„ ê²ƒ ê°™ë‹¤.<br>
<br>
ë³¸ë¡ ìœ¼ë¡œ ëŒì•„ì™€ì„œ Android.mkì™€ Application.mkì€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í–ˆë‹¤.<br>

### Android.mk
```
LOCAL_PATH := $(call my-dir)

include $(CLEAR_VARS)

LOCAL_MODULE := libpcap
# LOCAL_CFLAGS := -D_BSD_SOURCE
LOCAL_CFLAGS := -DHAVE_CONFIG_H
LOCAL_CFLAGS += -Dlint
LOCAL_CFLAGS += -D_U_="__attribute__((__unused__))"
LOCAL_CFLAGS += -Wall
# LOCAL_CFLAGS += -Werror
LOCAL_CFLAGS += -Wno-macro-redefined
LOCAL_CFLAGS += -Wno-pointer-arith
LOCAL_CFLAGS += -Wno-sign-compare
LOCAL_CFLAGS += -Wno-unused-parameter
LOCAL_CFLAGS += -Wno-unused-result
LOCAL_CFLAGS += -Wno-tautological-compare


LOCAL_SRC_FILES := \
    libpcap/bpf_dump.c \
    libpcap/bpf_filter.c \
    libpcap/bpf_image.c \
    libpcap/etherent.c \
    libpcap/fad-gifc.c \
    libpcap/fmtutils.c \
    libpcap/gencode.c \
    libpcap/grammar.c \
    libpcap/nametoaddr.c \
    libpcap/optimize.c \
    libpcap/pcap-common.c \
    libpcap/pcap-linux.c \
    libpcap/pcap-netfilter-linux-android.c \
    libpcap/pcap-usb-linux-common.c \
    libpcap/pcap-usb-linux.c \
    libpcap/pcap-util.c \
    libpcap/pcap.c \
    libpcap/savefile.c \
    libpcap/scanner.c \
    libpcap/sf-pcap.c \
    libpcap/sf-pcapng.c


LOCAL_SRC_FILES_linux += libpcap/missing/strlcpy.c

LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)

include $(BUILD_SHARED_LIBRARY)

# build 2
include $(CLEAR_VARS)
LOCAL_MODULE    := interface-list
LOCAL_SRC_FILES := interface-list.c 
LOCAL_STATIC_LIBRARIES := libpcap
LOCAL_C_INCLUDES := $(LOCAL_PATH) $(LOCAL_PATH)/libpcap
include $(BUILD_EXECUTABLE)
```


### Application.mk
```
APP_PLATFORM := android-23
# APP_ABI := armeabi-v7a arm64-v8a
APP_ALLOW_MISSING_DEPS := true
APP_STL := c++_shared
```

## ndk-build ì‹¤í–‰
ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ì´ì œ ndk-buildë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.
jniì˜ ìƒìœ„í´ë”ì—ì„œ ndk-build ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œì¼œì£¼ì.

```
ndk-build or /path/to/ndk-build
```

# â˜ğŸ» ê²°ë¡ 
Android.mkì™€ Application.mkê°€ Makeì˜ ëŠë¦° ë¹Œë“œì†ë„ë¡œ Soong í”„ë¡œì íŠ¸ë¡œ ëŒ€ì²´ë˜ë©´ì„œ,
ë§ì´ ì‚¬ìš©ë˜ì§„ ì•ŠëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤.
ë¿ë§Œ ì•„ë‹ˆë¼, Cmakeë‚˜ configureì²˜ëŸ¼ ëŒ€ì•ˆë„ ë§ì€ ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤.

í˜¹ì—¬ë‚˜ í•„ìš”í•˜ë‹¤ë©´ ìœ„ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.